<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Art Cafe ‚Äî Samarkand</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

<style>
:root{
  /* === Samarkand / Turquoise Dome + Sand === */
  --sand:#F6EAD6;
  --sand-2:#EFE1C8;

  --night0:#0F2A2E;
  --night1:#163C42;

  --turq:#2DD4C9;
  --turq-2:#1FBDB2;

  --gold:#D2B36A;

  --text-dark:#1E1B16;
  --text:#ffffff;

  --stroke: rgba(0,0,0,.10);
  --shadow: rgba(0,0,0,.18);

  --r-lg:24px;
  --r-md:22px;

  --vh: 1vh;
  --sticky-h: 86px;

  --accent: var(--turq);
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;}
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:var(--sand);
  color:var(--text-dark);
  min-height: calc(var(--vh) * 100);
  overflow-y:auto;
  overflow-x:hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: none;
  padding-bottom: calc(var(--sticky-h) + 16px);
  -webkit-text-size-adjust:100%;
}
.page{max-width:560px;margin:0 auto;}

/* soft sand texture */
body:before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none;
  background-image:
    radial-gradient(circle at 15% 10%, rgba(0,0,0,.030) 0 1px, rgba(0,0,0,0) 2px),
    radial-gradient(circle at 75% 35%, rgba(0,0,0,.025) 0 1px, rgba(0,0,0,0) 2px),
    radial-gradient(circle at 40% 80%, rgba(0,0,0,.020) 0 1px, rgba(0,0,0,0) 2px);
  opacity:.55;
}

/* header */
.header{
  /* ‚úÖ —á—É—Ç—å –±–æ–ª—å—à–µ —à–∞–ø–∫–∞ */
  padding:18px 12px 30px;
  background:
    radial-gradient(1200px 260px at 50% -30%, rgba(45,212,201,.28), rgba(45,212,201,0) 60%),
    linear-gradient(135deg, var(--night0), var(--night1));
  border-bottom:1px solid rgba(255,255,255,.14);
  box-shadow:0 12px 26px rgba(0,0,0,.24);
  display:flex;align-items:center;justify-content:center;
  position:relative;text-align:center;
  color:var(--text);
  overflow:hidden;
}
/* subtle pattern */
.header:before{
  content:"";
  position:absolute; inset:-40px;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.10) 0 2px, rgba(255,255,255,0) 3px),
    radial-gradient(circle at 60% 20%, rgba(255,255,255,.08) 0 2px, rgba(255,255,255,0) 3px),
    radial-gradient(circle at 80% 55%, rgba(255,255,255,.06) 0 2px, rgba(255,255,255,0) 3px);
  opacity:.45;
  pointer-events:none;
}
/* arched ‚Äúportal‚Äù */
.header:after{
  content:"";
  position:absolute;
  left:50%;
  top:10px;
  width:260px;
  height:140px;
  transform:translateX(-50%);
  border-radius: 160px 160px 26px 26px;
  border:1px solid rgba(210,179,106,.22);
  background: linear-gradient(180deg, rgba(45,212,201,.10), rgba(255,255,255,0));
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
  opacity:.55;
  pointer-events:none;
}

.header img{
  position:absolute;left:12px;
  /* ‚úÖ —á—É—Ç—å –±–æ–ª—å—à–µ –ª–æ–≥–æ */
  width:88px;height:88px;object-fit:contain;
  border-radius:18px;
  background:rgba(255,255,255,.10);
  padding:8px;
  border:1px solid rgba(255,255,255,.20);
  box-shadow:0 14px 30px rgba(0,0,0,.22);
  z-index:2;
}
.brand-wrap{display:flex;flex-direction:column;align-items:center;gap:4px;transform: translateX(16px);z-index:2;}
.brand-title{
  font-family:"Georgia","Times New Roman",Times,serif;
  font-size:30px;line-height:1;letter-spacing:.5px;font-weight:800;
}
.brand-title2{
  font-family:'Montserrat',sans-serif;
  font-weight:900;
  font-size:14px;
  letter-spacing:1.6px;
  line-height:1.15;
  color: rgba(255,255,255,.92);
}
.brand-phone{
  font-weight:900;
  font-size:12.8px;
  letter-spacing:.3px;
  opacity:.95;
  color:#fff;
}

/* –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
.welcome{
  margin-top:6px;
  font-weight:900;
  font-size:13px;
  opacity:.92;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.12);
  color:#fff;
}

/* header actions */
.header-actions{
  position:absolute;right:10px;top:0;bottom:0;
  display:flex;flex-direction:column;justify-content:center;align-items:flex-end;
  gap:10px;
  z-index:90;
}
.act-btn{
  width:42px;height:42px;border-radius:16px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;user-select:none;
  background:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.45), 0 10px 20px rgba(0,0,0,.16);
  transition:.15s;
}
.act-btn:active{transform:scale(.97);}
.burger{width:20px;height:14px;position:relative;}
.burger span{position:absolute;left:0;right:0;height:2.8px;border-radius:10px;background:#1b1b1b;opacity:.9;}
.burger span:nth-child(1){top:0;}
.burger span:nth-child(2){top:5.4px;}
.burger span:nth-child(3){bottom:0;}
.act-ico{font-size:18px;line-height:1;color:#1b1b1b;}

/* rows */
.langs{
  display:flex;
  gap:10px;
  padding:12px;
  justify-content:center;
  flex-wrap:nowrap;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}

/* base button */
.btn{
  padding:12px 18px;
  border-radius:28px;
  font-weight:900;
  min-width:112px;
  text-align:center;
  cursor:pointer;
  transition:.15s;
  border:1px solid rgba(30,27,22,.14);
  background:rgba(255,255,255,.88);
  color:var(--text-dark);
  box-shadow: 0 10px 22px rgba(0,0,0,.10);
  flex:0 0 auto;
}
.btn:active{transform:scale(.98);}

/* active = –±–∏—Ä—é–∑–æ–≤–∞—è */
.btn.active{
  background: linear-gradient(180deg, var(--turq), var(--turq-2));
  color: #063133;
  border:1px solid rgba(6,49,51,.18);
  box-shadow: 0 14px 26px rgba(0,0,0,.14);
}

/* category buttons */
.cat-btn{
  padding:12px 16px;
  min-width:132px;
  font-size:14px;
  /* ‚úÖ –∫–≤–∞–¥—Ä–∞—Ç—ã —Å –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º */
  border-radius:18px;
}

/* language buttons narrower + flags */
.langs .btn{
  min-width:92px;
  padding:10px 12px;
  border-radius:22px;
  font-size:13.5px;
}
.lang-flag{margin-right:8px; font-size:16px; line-height:1;}

/* categories + products */
.categories{display:flex;gap:12px;padding:14px;overflow-x:auto;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;overscroll-behavior-x:contain;}
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;padding:12px;}
.card{
  border-radius:24px;padding:12px;text-align:center;
  background:rgba(255,255,255,.92);
  border:1px solid rgba(30,27,22,.12);
  box-shadow: 0 12px 26px rgba(0,0,0,.12);
  transition:.15s;
  color:#1d1d1d;
}
.img{height:170px;display:flex;align-items:center;justify-content:center;margin-bottom:6px;}
.img img{max-width:150px;max-height:150px;object-fit:cover;transform:scale(1.06);cursor:pointer;border-radius:18px;}
.item-name{margin-top:2px;padding:0 6px;font-weight:900;line-height:1.15;min-height:42px;display:flex;align-items:center;justify-content:center;word-break:break-word;}
.item-meta{margin-top:6px;font-weight:800;font-size:12px;opacity:.82;line-height:1.15;min-height:16px;}
.price{font-weight:900;color:#0B5C60;margin-top:8px;}
.price small{font-weight:800;opacity:.75;margin-left:4px;}
.counter{display:flex;justify-content:center;gap:10px;margin-top:8px;align-items:center;}
.counter button{
  width:32px;height:32px;border-radius:50%;cursor:pointer;border:1px solid rgba(6,49,51,.22);
  background: linear-gradient(180deg, var(--turq), var(--turq-2));
  color:#063133;font-size:18px;font-weight:900;box-shadow:0 12px 24px rgba(0,0,0,.14);
  transition:.15s;
}
.counter button:active{transform:scale(.96);}

/* cart */
.cart{
  background:rgba(255,255,255,.92);
  color:#1d1d1d;
  margin:12px;padding:16px;border-radius:24px;border:1px solid rgba(30,27,22,.12);
  box-shadow: 0 12px 26px rgba(0,0,0,.12);
}
.input{
  margin:8px auto;display:block;padding:14px;width:85%;
  border-radius:22px;font-size:15px;border:1px solid rgba(30,27,22,.14);
  background:rgba(255,255,255,.94);
  box-shadow: 0 10px 22px rgba(0,0,0,.10);
  outline:none;transition:.15s;
  color:#2b2b2b;
}
textarea.input{height:90px;}
.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:24px;
  cursor:pointer;
  color:#063133;
  font-size:17px;
  font-weight:900;
  border:1px solid rgba(6,49,51,.18);
  background: linear-gradient(180deg, var(--turq), var(--turq-2));
  box-shadow: 0 14px 26px rgba(0,0,0,.14);
  position:relative;
  z-index:2;
  scroll-margin-bottom: calc(var(--sticky-h) + 24px);
}
#cartBox{
  scroll-margin-bottom: calc(var(--sticky-h) + 24px);
  padding-bottom: calc(16px + var(--sticky-h));
}

/* popup */
.popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s;}
.popup.show{opacity:1;pointer-events:auto;}
.popup-box{
  background:white;padding:26px;border-radius:24px;text-align:center;font-weight:800;border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 14px 26px rgba(0,0,0,.22);
  color:#1d1d1d;
}

/* image modal */
.img-modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.62);
  display:flex; align-items:center; justify-content:center;
  opacity:0; pointer-events:none;
  transition:.18s;
  z-index:2000;
  padding:18px;
}
.img-modal.show{opacity:1;pointer-events:auto;}
.img-modal-box{
  width:min(760px, 100%);
  border-radius:22px;
  overflow:hidden;
  background:#fff;
  border:1px solid rgba(0,0,0,.08);
  box-shadow:0 18px 44px rgba(0,0,0,.28);
}
.img-modal-top{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px;
  padding:12px 12px;
  background:rgba(0,0,0,.04);
}
.img-modal-title{font-weight:900;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.img-modal-close{
  width:38px;height:38px;border:none;border-radius:14px;background:transparent;cursor:pointer;
  font-size:22px;line-height:1;color:#666;
}
.img-modal-content{
  display:flex;
  gap:0;
  align-items:stretch;
}
.img-modal-left{
  flex: 1.15;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:14px;
  border-right:1px solid rgba(0,0,0,.08);
}
.img-modal-img{
  width:100%;
  max-height:70vh;
  object-fit:contain;
  background:#fff;
  display:block;
  border-radius:18px;
}
.img-modal-right{
  flex: 1;
  padding:14px 14px 16px;
  color:#1d1d1d;
}
.img-desc-title{
  font-weight:900;
  font-size:16px;
  line-height:1.15;
  margin-bottom:10px;
}
.img-desc-meta{
  font-weight:900;
  color:#0B5C60;
  margin-bottom:10px;
  white-space:pre-line;
}
.img-desc-text{
  font-weight:800;
  opacity:.9;
  line-height:1.28;
  white-space:pre-line;
}
.img-desc-chiprow{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0 0;}
.chip{
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.10);
  background:rgba(0,0,0,.03);
  font-weight:900;
  font-size:12px;
}

/* sticky */
.sticky-checkout{
  position:fixed;left:0;right:0;bottom:0;
  padding:10px 12px;
  background: rgba(15,42,46,.72);
  backdrop-filter: blur(10px);
  z-index:999;
  border-top:1px solid rgba(255,255,255,.14);
  height: var(--sticky-h);
  display:flex;
  align-items:center;
}
.sticky-inner{
  max-width:520px;margin:0 auto;border-radius:18px;padding:10px 12px;
  background:rgba(255,255,255,.92);
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 14px 26px rgba(0,0,0,.14);
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  width:100%;
  color:#1d1d1d;
}
.sticky-sum{font-weight:900;line-height:1.1;}
.sticky-sum small{display:block;font-weight:800;opacity:.75;margin-top:2px;}
.sticky-btn{
  padding:12px 14px;border-radius:16px;border:1px solid rgba(6,49,51,.18);
  background: linear-gradient(180deg, var(--turq), var(--turq-2));
  color:#063133;font-weight:900;cursor:pointer;
  box-shadow: 0 14px 26px rgba(0,0,0,.14);
}

/* bottom sheets */
.sheet-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);opacity:0;pointer-events:none;transition:.18s;z-index:1000;}
.sheet-backdrop.show{opacity:1;pointer-events:auto;}
.sheet{
  position:fixed;left:0; right:0;bottom:-100%;
  background:rgba(255,255,255,.94);
  color:#1d1d1d;
  border-top-left-radius:22px;border-top-right-radius:22px;border:1px solid rgba(0,0,0,.08);
  box-shadow:0 18px 40px rgba(0,0,0,.22);
  transition:.22s;z-index:1010;padding:10px 12px 14px;
  max-height: 86vh;overflow:auto;-webkit-overflow-scrolling:touch;
}
.sheet.show{bottom:0;}
.sheet-handle{width:44px;height:5px;border-radius:999px;background:rgba(0,0,0,.18);margin:6px auto 10px;}
.sheet-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.sheet-head b{font-size:16px;}
.sheet-close{width:38px;height:38px;border:none;border-radius:12px;background:transparent;cursor:pointer;font-size:22px;line-height:1;color:#777;}

/* menu list */
.menu-list{display:flex;flex-direction:column;gap:8px;}
.menu-item{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:12px 12px;border-radius:16px;border:1px solid rgba(0,0,0,.08);
  background:rgba(0,0,0,.03);
  cursor:pointer;text-decoration:none;color:#1d1d1d;
}
.menu-left{display:flex;align-items:center;gap:10px;min-width:0;}
.menu-ic{
  width:30px;height:30px;border-radius:12px;display:flex;align-items:center;justify-content:center;
  background: rgba(45,212,201,.12);
  border:1px solid rgba(6,49,51,.10);
  flex:0 0 auto;
}
.menu-txt{display:flex;flex-direction:column;min-width:0;}
.menu-name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.menu-sub{font-size:12px;opacity:.75;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
.menu-right{opacity:.65;font-weight:900;}

/* about blocks */
.about-desc{
  margin-top:10px;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.08);
  background:#fff;
  color:#1d1d1d;
  line-height:1.28;
  font-weight:800;
}
.about-desc b{font-weight:900;}
.about-desc .muted{opacity:.85;font-weight:800;}

/* search */
.search-title{display:none;width:100%;padding:10px 14px 0;font-weight:900;color:var(--text-dark);}
.search-title.show{display:block;}
.search-wrap{display:none;position:relative;padding:10px 12px 6px;gap:10px;align-items:center;}
.search-wrap.show{display:flex;}
.search-wrap .input{width:100%;margin:0;}
.search-clear{
  position:absolute;right:20px;top:50%;transform:translateY(-50%);
  width:32px;height:32px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,.06);
  border:1px solid rgba(0,0,0,.08);
  cursor:pointer;color:#333;font-weight:900;
}

@media (max-width:520px){
  .img-modal-content{flex-direction:column;}
  .img-modal-left{border-right:none;border-bottom:1px solid rgba(0,0,0,.08);}
  .img-modal-img{max-height:52vh;}
}
@media (max-width:420px){
  .brand-title{font-size:28px;}
  .brand-title2{font-size:13px;}
  .brand-wrap{transform: translateX(10px);}
  .header{padding:16px 10px 28px;}
  .input{width:92%;}
  .products{gap:14px;}
}
@media (max-width:360px){
  .header img{width:80px;height:80px;left:10px;}
  .brand-title{font-size:26px;}
  .brand-title2{font-size:12px;letter-spacing:1.3px;}
  .brand-phone{font-size:12px;}
  .btn{min-width:108px;padding:12px 16px;}
  .cat-btn{min-width:126px;padding:12px 14px;font-size:13px;}
  .langs .btn{min-width:86px;padding:10px 10px;font-size:13px;}
  .welcome{font-size:12px;padding:6px 9px;}
}
</style>
</head>

<body>

<div class="header">
  <img src="images/logo.png" onerror="this.src='logo.png'" alt="Art Cafe logo">

  <div class="brand-wrap">
    <div class="brand-title">Art Cafe</div>
    <div class="brand-title2" id="brandSub">SAMARKAND</div>

    <!-- ‚úÖ –Ω–æ–º–µ—Ä –ø–æ–¥ SAMARKAND -->
    <div class="brand-phone" id="brandPhone">+998 (91) 534-40-44</div>

    <div class="welcome" id="welcomeLine" style="display:none;"></div>
  </div>

  <div class="header-actions">
    <div class="act-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
      <div class="burger"><span></span><span></span><span></span></div>
    </div>

    <!-- ‚úÖ –≥–µ–æ–ø–æ–∑–∏—Ü–∏—è –ø–æ–¥ –±—É—Ä–≥–µ—Ä–æ–º -->
    <div class="act-btn" onclick="openMapsHeader(event)" title="–û—Ç–∑—ã–≤—ã / –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è">
      <span class="act-ico">üìç</span>
    </div>

    <div class="act-btn" onclick="toggleSearch()" title="–ü–æ–∏—Å–∫">
      <span class="act-ico">üîç</span>
    </div>
  </div>
</div>

<div class="page">

<!-- top menu (–±—É—Ä–≥–µ—Ä) -->
<div class="sheet-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>
<div class="sheet" id="menuSheet">
  <div class="sheet-handle"></div>
  <div class="sheet-head">
    <b id="menuTitle">–ú–µ–Ω—é</b>
    <button class="sheet-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">

    <!-- ‚úÖ –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º -->
    <div class="menu-item" onclick="openManager(event)" role="button">
      <div class="menu-left">
        <div class="menu-ic">üí¨</div>
        <div class="menu-txt">
          <div class="menu-name" id="mManagerTitle">–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</div>
          <div class="menu-sub" id="mManagerSub">Telegram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <!-- ‚úÖ –Æ—Ä –ª–∏—Ü–∞–º -->
    <div class="menu-item" onclick="toggleLegal()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üè¢</div>
        <div class="menu-txt">
          <div class="menu-name" id="mLegalTitle">–Æ—Ä –ª–∏—Ü–∞–º</div>
          <div class="menu-sub" id="mLegalSub">@artcafesamarkand@gmail.com ‚Ä¢ +998 93 746-00-22</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div id="legalWrap" style="display:none; padding:6px 4px 10px;">
      <div style="border:1px solid rgba(0,0,0,.08); border-radius:16px; overflow:hidden; background:rgba(0,0,0,.03); padding:12px;">
        <div style="font-weight:900; margin-bottom:6px;" id="legalLabel">üè¢ –Æ—Ä –ª–∏—Ü–∞–º</div>

        <div style="font-weight:900; margin-bottom:6px;">üìß Email</div>
        <a href="mailto:artcafesamarkand@gmail.com" onclick="openEmail(event)" style="text-decoration:none; font-weight:900; color:#0B5C60;">
          artcafesamarkand@gmail.com
        </a>

        <div style="height:12px;"></div>

        <div style="font-weight:900; margin-bottom:6px;">üìû –¢–µ–ª–µ—Ñ–æ–Ω</div>
        <a href="tel:+998937460022" onclick="callLegalPhone(event)" style="text-decoration:none; font-weight:900; color:#0B5C60;">
          +998 93 746-00-22
        </a>
      </div>
    </div>

    <!-- –ü–æ–∑–≤–æ–Ω–∏—Ç—å -->
    <a class="menu-item" href="tel:+998915344044" onclick="callPhone(event)">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name" id="mCallTitle">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub" id="mCallSub">+998 (91) 534-40-44</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <!-- Instagram -->
    <a class="menu-item" href="#" onclick="openInstagram(event)">
      <div class="menu-left">
        <div class="menu-ic" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" style="display:block;">
            <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4.3A5.7 5.7 0 1 1 6.3 14 5.7 5.7 0 0 1 12 8.3zm0 2A3.7 3.7 0 1 0 15.7 14 3.7 3.7 0 0 0 12 10.3zM18 6.7a1 1 0 1 1-1 1 1 1 0 0 1 1-1z"/>
          </svg>
        </div>
        <div class="menu-txt">
          <div class="menu-name" id="mInstaTitle">@artcafesamarkand</div>
          <div class="menu-sub" id="mInstaSub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <!-- ‚úÖ –ö–Ω–æ–ø–∫—É –û –∫–∞—Ñ–µ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –≤ —Å–∞–º—ã–π –Ω–∏–∑ -->
    <div class="menu-item" onclick="toggleAbout()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚ÑπÔ∏è</div>
        <div class="menu-txt">
          <div class="menu-name" id="mAboutTitle">–û –∫–∞—Ñ–µ</div>
          <div class="menu-sub" id="mAboutSub">–ö–æ–Ω—Ç–∞–∫—Ç—ã, –≥—Ä–∞—Ñ–∏–∫, –∞–¥—Ä–µ—Å</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div id="aboutWrap" style="display:none; padding:6px 4px 10px;">
      <div style="border:1px solid rgba(0,0,0,.08); border-radius:16px; overflow:hidden; background:rgba(0,0,0,.03); padding:12px;">
        <div style="font-weight:900; margin-bottom:6px;" id="aboutAddrLabel">üìç –ê–¥—Ä–µ—Å / –û—Ç–∑—ã–≤—ã</div>

        <button class="btn" style="width:100%; min-width:auto;" onclick="openMaps(event)" id="mapsBtn">
          üìç –û—Ç–∫—Ä—ã—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –∏ –æ—Ç–∑—ã–≤—ã (–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã)
        </button>

        <div style="height:12px;"></div>

        <div style="font-weight:900; margin-bottom:6px;" id="aboutPhoneLabel">üìû –¢–µ–ª–µ—Ñ–æ–Ω</div>
        <a href="tel:+998915344044" onclick="callPhone(event)" style="text-decoration:none; font-weight:900; color:#0B5C60;" id="aboutPhoneNum">
          +998 (91) 534-40-44
        </a>

        <div style="height:12px;"></div>

        <div style="font-weight:900; margin-bottom:6px;" id="aboutHoursLabel">üïí –ì—Ä–∞—Ñ–∏–∫</div>
        <div style="font-weight:900; color:#1d1d1d; opacity:.92;" id="aboutHoursText">09:00‚Äì18:00</div>

        <div class="about-desc" id="aboutDescText"></div>
      </div>
    </div>

  </div>
</div>

<!-- search -->
<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<!-- —è–∑—ã–∫–∏ RU / UZ / EN -->
<div class="langs">
  <button class="btn" id="langRU" onclick="setLang('ru',this)"><span class="lang-flag">üá∑üá∫</span>RU</button>
  <button class="btn" id="langUZ" onclick="setLang('uz',this)"><span class="lang-flag">üá∫üáø</span>UZ</button>
  <button class="btn" id="langEN" onclick="setLang('en',this)"><span class="lang-flag">üá¨üáß</span>EN</button>
</div>

<!-- –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã -->
<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<!-- –∫–æ—Ä–∑–∏–Ω–∞ -->
<div class="cart" id="cartBox">
  <b id="cartTitle"></b>: <span id="total">0</span> <span id="sumWord">—Å—É–º</span>

  <div style="margin-top:10px; font-weight:900;">
    <span id="totalLabel">–ò—Ç–æ–≥–æ</span>: <span id="grandTotal">0</span> <span id="sumWord2">—Å—É–º</span>
  </div>

  <textarea id="comment" class="input"></textarea>

  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
  <div style="height: 12px;"></div>
</div>

<div class="popup" id="popup"><div class="popup-box" id="popupText">‚úÖ</div></div>

<!-- modal image + description -->
<div class="img-modal" id="imgModal" onclick="closeImgModal(event)">
  <div class="img-modal-box" onclick="event.stopPropagation()">
    <div class="img-modal-top">
      <div class="img-modal-title" id="imgModalTitle">–§–æ—Ç–æ</div>
      <button class="img-modal-close" onclick="closeImgModal(event)">√ó</button>
    </div>

    <div class="img-modal-content">
      <div class="img-modal-left">
        <img class="img-modal-img" id="imgModalImg" src="" alt="">
      </div>
      <div class="img-modal-right">
        <div class="img-desc-title" id="imgDescTitle"></div>
        <div class="img-desc-meta" id="imgDescMeta"></div>
        <div class="img-desc-text" id="imgDescText"></div>
        <div class="img-desc-chiprow" id="imgDescChips"></div>
      </div>
    </div>
  </div>
</div>

<!-- sticky cart -->
<div class="sticky-checkout" id="stickyBar">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small id="sumCurrency">—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="openCart()" id="stickyCartBtn">–ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</div>

</div><!-- /page -->

<script>
Telegram.WebApp.ready();
try{ Telegram.WebApp.expand(); Telegram.WebApp.disableVerticalSwipes?.(); }catch(_){}

function setVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight*0.01)+'px'); }
setVH();
window.addEventListener('resize', setVH, {passive:true});
window.addEventListener('orientationchange', ()=>setTimeout(setVH, 250), {passive:true});

function syncStickyHeight(){
  const el = document.getElementById('stickyBar');
  if(!el) return;
  const h = Math.ceil(el.getBoundingClientRect().height || 86);
  document.documentElement.style.setProperty('--sticky-h', h + 'px');
}
window.addEventListener('resize', ()=>setTimeout(syncStickyHeight, 50), {passive:true});
window.addEventListener('orientationchange', ()=>setTimeout(syncStickyHeight, 250), {passive:true});

/* DOM refs */
const menuBackdrop = document.getElementById('menuBackdrop');
const menuSheet    = document.getElementById('menuSheet');
const menuTitle    = document.getElementById('menuTitle');

const mAboutTitle  = document.getElementById('mAboutTitle');
const mAboutSub    = document.getElementById('mAboutSub');
const aboutAddrLabel  = document.getElementById('aboutAddrLabel');
const aboutPhoneLabel = document.getElementById('aboutPhoneLabel');
const aboutHoursLabel = document.getElementById('aboutHoursLabel');
const aboutPhoneNum   = document.getElementById('aboutPhoneNum');
const aboutHoursText  = document.getElementById('aboutHoursText');
const mapsBtn         = document.getElementById('mapsBtn');

const mCallTitle   = document.getElementById('mCallTitle');
const mCallSub     = document.getElementById('mCallSub');
const mInstaTitle  = document.getElementById('mInstaTitle');
const mInstaSub    = document.getElementById('mInstaSub');

const searchTitle  = document.getElementById('searchTitle');
const searchWrap   = document.getElementById('searchWrap');
const searchInput  = document.getElementById('searchInput');

const cats         = document.getElementById('cats');
const products     = document.getElementById('products');

const cartTitle    = document.getElementById('cartTitle');
const totalLabel   = document.getElementById('totalLabel');
const orderBtn     = document.getElementById('orderBtn');
const comment      = document.getElementById('comment');

const sumCurrency  = document.getElementById('sumCurrency');
const sumWord      = document.getElementById('sumWord');
const sumWord2     = document.getElementById('sumWord2');

const stickyCartBtn= document.getElementById('stickyCartBtn');

const total        = document.getElementById('total');
const grandTotal   = document.getElementById('grandTotal');
const stickyTotal  = document.getElementById('stickyTotal');

const popup        = document.getElementById('popup');
const popupText    = document.getElementById('popupText');

const imgModal     = document.getElementById('imgModal');
const imgModalTitle= document.getElementById('imgModalTitle');
const imgModalImg  = document.getElementById('imgModalImg');
const imgDescTitle = document.getElementById('imgDescTitle');
const imgDescMeta  = document.getElementById('imgDescMeta');
const imgDescText  = document.getElementById('imgDescText');

/* links/settings */
const INSTA_URL = "https://www.instagram.com/artcafesamarkand/";
const MAPS_URL  = "https://yandex.ru/maps/-/CPqibK2o";
const PHONE_RAW = "+998915344044";
const PHONE_HUMAN = "+998 (91) 534-40-44";

/* ‚úÖ —é—Ä –ª–∏—Ü–∞–º + –º–µ–Ω–µ–¥–∂–µ—Ä */
const LEGAL_EMAIL = "artcafesamarkand@gmail.com";
const LEGAL_PHONE_RAW = "+998937460022";
const LEGAL_PHONE_HUMAN = "+998 93 746-00-22";
const MANAGER_ID = 6013591658;

/* Telegram user */
const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

/* UI translations */
const UI = {
  ru:{
    brandSub:'SAMARKAND',
    menu:'–ú–µ–Ω—é',
    aboutTitle:'–û –∫–∞—Ñ–µ',
    aboutSub:'–ö–æ–Ω—Ç–∞–∫—Ç—ã, –≥—Ä–∞—Ñ–∏–∫, –∞–¥—Ä–µ—Å',
    aboutAddr:'üìç –ê–¥—Ä–µ—Å / –û—Ç–∑—ã–≤—ã',
    aboutPhone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',
    aboutHours:'üïí –ì—Ä–∞—Ñ–∏–∫',
    callTitle:'–ü–æ–∑–≤–æ–Ω–∏—Ç—å',
    instaSub:'–û—Ç–∫—Ä—ã—Ç—å Instagram',
    searchResults:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',
    cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',
    total:'–ò—Ç–æ–≥–æ',
    order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
    comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä: –∞–¥—Ä–µ—Å, –≤—Ä–µ–º—è, –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ)',
    sum:'—Å—É–º',
    empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è',
    welcome:'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å',
    metaPrefix:'–ü–æ—Ä—Ü–∏—è / –û–±—ä—ë–º',
    price:'–¶–µ–Ω–∞',
    nothing:'–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
    mapsBtn:'üìç –û—Ç–∫—Ä—ã—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –∏ –æ—Ç–∑—ã–≤—ã (–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã)',
    managerTitle:'–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º',
    managerSub:'Telegram',
    legalTitle:'–Æ—Ä –ª–∏—Ü–∞–º',
    legalSub:`${LEGAL_EMAIL} ‚Ä¢ ${LEGAL_PHONE_HUMAN}`
  },
  uz:{
    brandSub:'SAMARKAND',
    menu:'Menyu',
    aboutTitle:'Kafe haqida',
    aboutSub:"Kontaktlar, ish vaqti, manzil",
    aboutAddr:'üìç Manzil / Sharhlar',
    aboutPhone:'üìû Telefon',
    aboutHours:'üïí Ish vaqti',
    callTitle:"Qo'ng'iroq qilish",
    instaSub:"Instagramni ochish",
    searchResults:'Qidiruv natijalari',
    cart:'üõí Savat',
    total:'Jami',
    order:'Buyurtma berish',
    comment:"‚úçÔ∏è Izoh (masalan: manzil, vaqt, izoh)",
    sum:"so‚Äòm",
    empty:"Savat bo‚Äòsh",
    welcome:'üëã Xush kelibsiz',
    metaPrefix:"Porsiya / Hajm",
    price:'Narx',
    nothing:"Hech narsa topilmadi",
    mapsBtn:"üìç Geolokatsiya va sharhlar (Yandex Maps)",
    managerTitle:'Menejer bilan bog‚Äòlanish',
    managerSub:'Telegram',
    legalTitle:'Yuridik shaxslar',
    legalSub:`${LEGAL_EMAIL} ‚Ä¢ ${LEGAL_PHONE_HUMAN}`
  },
  en:{
    brandSub:'SAMARKAND',
    menu:'Menu',
    aboutTitle:'About cafe',
    aboutSub:'Contacts, hours, address',
    aboutAddr:'üìç Location / Reviews',
    aboutPhone:'üìû Phone',
    aboutHours:'üïí Working hours',
    callTitle:'Call',
    instaSub:'Open Instagram',
    searchResults:'Search results',
    cart:'üõí Cart',
    total:'Total',
    order:'Place order',
    comment:'‚úçÔ∏è Comment (e.g., address/time/note)',
    sum:'sum',
    empty:'Cart is empty',
    welcome:'üëã Welcome',
    metaPrefix:'Portion / Volume',
    price:'Price',
    nothing:'Nothing found',
    mapsBtn:'üìç Open location & reviews (Yandex Maps)',
    managerTitle:'Contact manager',
    managerSub:'Telegram',
    legalTitle:'For companies',
    legalSub:`${LEGAL_EMAIL} ‚Ä¢ ${LEGAL_PHONE_HUMAN}`
  }
};

let lang='ru';

/* helpers */
function escapeHtml(s){return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
function formatSum(x){const n = Number(x) || 0; return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');}

/* item builder */
function mkFood(id, name, meta, price, catKey){
  const catName = CATEGORY_LABELS?.[catKey]?.[lang] || catKey;
  const metaText = meta ? String(meta) : '';
  return {
    id,
    p: Number(price)||0,
    meta: metaText,
    img: `images/${id}.jpg`,
    n: {ru:name, uz:name, en:name},
    desc: {
      ru: `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${catName}\n${UI.ru.metaPrefix}: ${metaText || '‚Äî'}\n\n–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –Ω–∞–∂–º–∏—Ç–µ ‚Äú${UI[lang].order}‚Äù.`,
      uz: `Kategoriya: ${catName}\n${UI.uz.metaPrefix}: ${metaText || '‚Äî'}\n\nSavatga qo‚Äòshing va ‚Äú${UI[lang].order}‚Äù tugmasini bosing.`,
      en: `Category: ${catName}\n${UI.en.metaPrefix}: ${metaText || '‚Äî'}\n\nAdd to cart and press ‚Äú${UI[lang].order}‚Äù.`
    }
  };
}

/* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–ª—é–¥ */
const CATEGORY_LABELS = {
  salads:   {ru:'–°–∞–ª–∞—Ç—ã', uz:'Salatlar', en:'Salads'},
  snacks:   {ru:'–ó–∞–∫—É—Å–∫–∏', uz:'Gazaklar', en:'Appetizers'},
  soups:    {ru:'–°—É–ø—ã', uz:'Sho‚Äòrvalar', en:'Soups'},
  hot:      {ru:'–ì–æ—Ä—è—á–∏–µ –±–ª—é–¥–∞', uz:'Issiq taomlar', en:'Hot dishes'},
  bread:    {ru:'–•–ª–µ–±', uz:'Non', en:'Bread'},
  sauces:   {ru:'–°–æ—É—Å—ã', uz:'Souslar', en:'Sauces'},
  sides:    {ru:'–ì–∞—Ä–Ω–∏—Ä—ã', uz:'Garnirlar', en:'Sides'},
  desserts: {ru:'–î–µ—Å–µ—Ä—Ç—ã', uz:'Desertlar', en:'Desserts'},
  coffee:   {ru:'–ö–æ—Ñ–µ', uz:'Qahva', en:'Coffee'},
  tea:      {ru:'–ß–∞–π', uz:'Choy', en:'Tea'},
  fresh:    {ru:'–§—Ä–µ—à', uz:'Fresh', en:'Fresh juice'},
  lemonades:{ru:'–õ–∏–º–æ–Ω–∞–¥—ã', uz:'Limonadlar', en:'Lemonades'},
  milkshake:{ru:'–ú–∏–ª–∫—à–µ–π–∫', uz:'Milkshake', en:'Milkshakes'},
  drinks:   {ru:'–ù–∞–ø–∏—Ç–∫–∏', uz:'Ichimliklar', en:'Drinks'},
  mineral:  {ru:'–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–æ–¥–∞', uz:'Mineral suv', en:'Mineral water'}
};

const MAIN_CATS = [
  {key:'salads'},{key:'snacks'},{key:'soups'},{key:'hot'},{key:'bread'},
  {key:'sauces'},{key:'sides'},{key:'desserts'},{key:'coffee'},{key:'tea'},
  {key:'fresh'},{key:'lemonades'},{key:'milkshake'},{key:'drinks'},{key:'mineral'}
];

let category = 'salads';
let cart = {};

/* MENU (–≤–∞—à –ø—Ä–∞–π—Å) */
const MENU = {
  salads: [
    mkFood('salad_svezhiy', '–°–≤–µ–∂–∏–π', '', 30000, 'salads'),
    mkFood('salad_achichuk', '–ê—á–∏—á—É–∫', '', 30000, 'salads'),
    mkFood('salad_mazhnuntol', '–ú–∞–∂–Ω—É–Ω—Ç–æ–ª', '', 50000, 'salads'),
    mkFood('salad_baklazhany_khrust', '–°–∞–ª–∞—Ç —Å —Ö—Ä—É—Å—Ç—è—â–∏–º–∏ –±–∞–∫–ª–∞–∂–∞–Ω–∞–º–∏', '', 40000, 'salads'),
    mkFood('salad_tashkent', '–¢–∞—à–∫–µ–Ω—Ç', '', 50000, 'salads'),
    mkFood('salad_anzhir', '–ê–Ω–∂–∏—Ä', '', 50000, 'salads'),
    mkFood('salad_vesenniy', '–í–µ—Å–µ–Ω–Ω–∏–π', '', 30000, 'salads')
  ],
  snacks: [
    mkFood('snack_svezhie_ovoshi_zelen', '–°–≤–µ–∂–∏–µ –æ–≤–æ—â–∏ —Å –∑–µ–ª–µ–Ω—å—é', '', 60000, 'snacks'),
    mkFood('snack_ovoshi_dom_posol', '–û–≤–æ—â–∏ –¥–æ–º–∞—à–Ω–µ–≥–æ –ø–æ—Å–æ–ª–∞', '', 70000, 'snacks'),
    mkFood('snack_myasnoe_assorti', '–ú—è—Å–Ω–æ–µ –∞—Å—Å–æ—Ä—Ç–∏', '', 100000, 'snacks'),
    mkFood('snack_dolma', '–î–æ–ª–º–∞', '', 70000, 'snacks'),
    mkFood('snack_chakka_assorti', '–ß–∞–∫–∫–∞ –ê—Å—Å–æ—Ä—Ç–∏', '', 30000, 'snacks')
  ],
  soups: [
    mkFood('soup_shurpa_nut', '–®—É—Ä–ø–∞ —Å –Ω—É—Ç–æ–º', '', 60000, 'soups'),
    mkFood('soup_mashkhurda', '–ú–∞—à—Ö—É—Ä–¥–∞', '', 50000, 'soups'),
    mkFood('soup_mampar_veg', '–ú–∞–º–ø–∞—Ä –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∏–π', '', 40000, 'soups'),
    mkFood('soup_lagman', '–õ–∞–≥–º–∞–Ω', '', 50000, 'soups'),
    mkFood('soup_kuriny_lapsha', '–ö—É—Ä–∏–Ω—ã–π —Å –¥–æ–º–∞—à–Ω–µ–π –ª–∞–ø—à–æ–π', '', 40000, 'soups'),
    mkFood('soup_mastava', '–ú–∞—Å—Ç–∞–≤–∞', '', 50000, 'soups')
  ],
  hot: [
    mkFood('hot_plov_05', '–ü–ª–æ–≤', '0.5 –ø–æ—Ä—Ü–∏—è', 50000, 'hot'),
    mkFood('hot_plov_07', '–ü–ª–æ–≤', '0.7 –ø–æ—Ä—Ü–∏—è', 70000, 'hot'),
    mkFood('hot_plov_1',  '–ü–ª–æ–≤', '1 –ø–æ—Ä—Ü–∏—è', 100000, 'hot'),

    mkFood('hot_manti_govyadina_1', '–ú–∞–Ω—Ç—ã —Å –≥–æ–≤—è–¥–∏–Ω–æ–π 1 —à—Ç', '', 10000, 'hot'),
    mkFood('hot_manti_tykva', '–ú–∞–Ω—Ç—ã —Å —Ç—ã–∫–≤–æ–π (—Å–µ–∑–æ–Ω–Ω—ã–µ)', '', 10000, 'hot'),
    mkFood('hot_manti_zelen', '–ú–∞–Ω—Ç—ã —Å –∑–µ–ª–µ–Ω—å—é (—Å–µ–∑–æ–Ω–Ω—ã–µ)', '', 10000, 'hot'),

    mkFood('hot_samsa_govyadina', '–°–∞–º—Å–∞ —Å –≥–æ–≤—è–¥–∏–Ω–æ–π', '', 12000, 'hot'),
    mkFood('hot_samsa_tykva', '–°–∞–º—Å–∞ —Å —Ç—ã–∫–≤–æ–π (—Å–µ–∑–æ–Ω–Ω—ã–µ)', '', 12000, 'hot'),
    mkFood('hot_samsa_zelen', '–°–∞–º—Å–∞ —Å –∑–µ–ª–µ–Ω—å—é (—Å–µ–∑–æ–Ω–Ω—ã–µ)', '', 12000, 'hot'),

    mkFood('hot_zharkoe_kurica', '–ñ–∞—Ä–∫–æ–µ —Å –∫—É—Ä–∏—Ü–µ–π', '', 80000, 'hot'),
    mkFood('hot_zhizbiz_05', '–ñ–∏–∑-–±–∏–∑ –∏–∑ –≥–æ–≤—è–¥–∏–Ω—ã', '0.5 –ø–æ—Ä—Ü–∏—è', 250000, 'hot'),
    mkFood('hot_zhizbiz_1',  '–ñ–∏–∑-–±–∏–∑ –∏–∑ –≥–æ–≤—è–¥–∏–Ω—ã', '1 –ø–æ—Ä—Ü–∏—è', 500000, 'hot'),
    mkFood('hot_tuy_kabob', '–¢—É–π –∫–∞–±–æ–±', '', 150000, 'hot'),
    mkFood('hot_zhareny_lagman', '–ñ–∞—Ä–µ–Ω—ã–π –ª–∞–≥–º–∞–Ω', '', 70000, 'hot')
  ],
  bread: [
    mkFood('bread_assorti', '–ê—Å—Å–æ—Ä—Ç–∏', '', 25000, 'bread'),
    mkFood('bread_chapchak', '–ß–∞–ø—á–∞–∫', '', 10000, 'bread')
  ],
  sauces: [
    mkFood('sauce_soevy', '–°–æ–µ–≤—ã–π', '', 10000, 'sauces'),
    mkFood('sauce_chesnochny', '–ß–µ—Å–Ω–æ—á–Ω—ã–π', '', 10000, 'sauces'),
    mkFood('sauce_tomatny', '–¢–æ–º–∞—Ç–Ω—ã–π', '', 10000, 'sauces'),
    mkFood('sauce_lazdzhan', '–õ–∞–∑–¥–∂–∞–Ω', '', 10000, 'sauces')
  ],
  sides: [
    mkFood('side_ris', '–†–∏—Å', '', 20000, 'sides'),
    mkFood('side_ris_ovoshi', '–†–∏—Å —Å –æ–≤–æ—â–∞–º–∏', '', 25000, 'sides'),
    mkFood('side_kartofel_fri', '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏', '', 20000, 'sides'),
    mkFood('side_kartofel_derev', '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ø–æ –¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏', '', 20000, 'sides'),
    mkFood('side_pure', '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω–æ–µ –ø—é—Ä–µ', '', 20000, 'sides')
  ],
  desserts: [
    mkFood('dessert_trubochka_sgush', '–¢—Ä—É–±–æ—á–∫–∞ —Å–æ —Å–≥—É—â–æ–Ω–∫–æ–π', '', 10000, 'desserts'),
    mkFood('dessert_ekler', '–≠–∫–ª–µ—Ä', '', 15000, 'desserts'),
    mkFood('dessert_keks', '–ö–µ–∫—Å', '', 10000, 'desserts'),
    mkFood('dessert_trubochka_tvorog', '–¢—Ä—É–±–æ—á–∫–∞ —Å —Ç–≤–æ—Ä–æ–≥–æ–º', '', 7000, 'desserts')
  ],
  coffee: [
    mkFood('coffee_turka', '–ö–æ—Ñ–µ –≤ —Ç—É—Ä–∫–µ', '', 20000, 'coffee'),
    mkFood('coffee_espresso', '–≠—Å–ø—Ä–µ—Å—Å–æ', '', 25000, 'coffee'),
    mkFood('coffee_double_espresso', '–î–≤–æ–π–Ω–æ–π —ç—Å–ø—Ä–µ—Å—Å–æ', '', 30000, 'coffee'),
    mkFood('coffee_cappuccino', '–ö–∞–ø—É—á–∏–Ω–æ', '', 35000, 'coffee'),
    mkFood('coffee_latte', '–õ–∞—Ç—Ç–µ', '', 35000, 'coffee'),
    mkFood('coffee_raf', '–†–∞—Ñ', '', 40000, 'coffee'),
    mkFood('coffee_flat_white', '–§–ª—ç—Ç –£–∞–π—Ç', '', 35000, 'coffee'),
    mkFood('coffee_espresso_macchiato', '–≠—Å–ø—Ä–µ—Å—Å–æ –º–∞–∫–∏–∞—Ç–∞', '', 25000, 'coffee'),
    mkFood('coffee_cacao', '–ö–∞–∫–∞–æ', '', 35000, 'coffee'),
    mkFood('coffee_syrups', '–°–∏—Ä–æ–ø—ã', '–¥–æ–±–∞–≤–∫–∞', 3000, 'coffee')
  ],
  tea: [
    mkFood('tea_black_05', '–ß–µ—Ä–Ω—ã–π', '0.5 L', 20000, 'tea'),
    mkFood('tea_green_05', '–ó–µ–ª–µ–Ω—ã–π', '0.5 L', 20000, 'tea'),
    mkFood('tea_lemon_05', '–ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º', '0.5 L', 25000, 'tea'),
    mkFood('tea_moroccan_05', '–ú–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∏–π', '0.5 L', 40000, 'tea'),
    mkFood('tea_fruit_05', '–§—Ä—É–∫—Ç–æ–≤—ã–π', '0.5 L', 40000, 'tea'),
    mkFood('tea_berry_05', '–Ø–≥–æ–¥–Ω—ã–π', '0.5 L', 40000, 'tea'),
    mkFood('tea_sea_buckthorn_05', '–û–±–ª–µ–ø–∏—Ö–æ–≤—ã–π', '0.5 L', 40000, 'tea'),
    mkFood('tea_jasmine_05', '–ñ–∞—Å–º–∏–Ω–æ–≤—ã–π', '0.5 L', 30000, 'tea'),
    mkFood('tea_mulled_na_03', '–ì–ª–∏–Ω—Ç–≤–µ–π–Ω (–±/–∞)', '0.3 L', 40000, 'tea')
  ],
  fresh: [
    mkFood('fresh_orange_03', '–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π', '0.3 L', 60000, 'fresh'),
    mkFood('fresh_carrot_03', '–ú–æ—Ä–∫–æ–≤–Ω—ã–π', '0.3 L', 30000, 'fresh'),
    mkFood('fresh_apple_03', '–Ø–±–ª–æ—á–Ω—ã–π', '0.3 L', 40000, 'fresh'),
    mkFood('fresh_grapefruit_03', '–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç–æ–≤—ã–π', '0.3 L', 60000, 'fresh'),
    mkFood('fresh_carrot_apple_03', '–ú–æ—Ä–∫–æ–≤–Ω–æ-—è–±–ª–æ—á–Ω—ã–π', '0.3 L', 40000, 'fresh'),
    mkFood('fresh_watermelon_03', '–ê—Ä–±—É–∑–Ω—ã–π (—Å–µ–∑–æ–Ω–Ω—ã–π)', '0.3 L', 40000, 'fresh'),
    mkFood('fresh_lemon_03', '–õ–∏–º–æ–Ω–Ω—ã–π', '0.3 L', 50000, 'fresh'),
    mkFood('fresh_grapefruit_carrot_03', '–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç–æ–≤–æ-–º–æ—Ä–∫–æ–≤–Ω—ã–π', '0.3 L', 50000, 'fresh'),
    mkFood('fresh_pomegranate_03', '–ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π', '0.3 L', 50000, 'fresh')
  ],
  lemonades: [
    mkFood('lemonade_tarkhun_04', '–¢–∞—Ä—Ö—É–Ω', '0.4 L', 30000, 'lemonades'),
    mkFood('lemonade_tarkhun_1', '–¢–∞—Ä—Ö—É–Ω', '1 L', 60000, 'lemonades'),

    mkFood('lemonade_apple_joy_04', '–Ø–±–ª–æ—á–Ω–æ–µ –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏–µ', '0.4 L', 50000, 'lemonades'),
    mkFood('lemonade_apple_joy_1', '–Ø–±–ª–æ—á–Ω–æ–µ –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏–µ', '1 L', 100000, 'lemonades'),

    mkFood('lemonade_turkish_04', '–¢—É—Ä–µ—Ü–∫–∏–π', '0.4 L', 30000, 'lemonades'),
    mkFood('lemonade_turkish_1', '–¢—É—Ä–µ—Ü–∫–∏–π', '1 L', 60000, 'lemonades'),

    mkFood('lemonade_exotic_04', '–≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–π', '0.4 L', 30000, 'lemonades'),
    mkFood('lemonade_exotic_1', '–≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–π', '1 L', 60000, 'lemonades'),

    mkFood('lemonade_mojito_04', '–ú–æ—Ö–∏—Ç–æ', '0.4 L', 30000, 'lemonades'),
    mkFood('lemonade_mojito_1', '–ú–æ—Ö–∏—Ç–æ', '1 L', 60000, 'lemonades'),

    mkFood('lemonade_strawberry_mojito_04', '–ö–ª—É–±–Ω–∏—á–Ω—ã–π –º–æ—Ö–∏—Ç–æ', '0.4 L', 35000, 'lemonades'),
    mkFood('lemonade_strawberry_mojito_1', '–ö–ª—É–±–Ω–∏—á–Ω—ã–π –º–æ—Ö–∏—Ç–æ', '1 L', 65000, 'lemonades'),

    mkFood('lemonade_homemade_berry_04', '–î–æ–º–∞—à–Ω–∏–π —è–≥–æ–¥–Ω—ã–π', '0.4 L', 30000, 'lemonades'),
    mkFood('lemonade_homemade_berry_1', '–î–æ–º–∞—à–Ω–∏–π —è–≥–æ–¥–Ω—ã–π', '1 L', 60000, 'lemonades'),

    mkFood('lemonade_homemade_citrus_04', '–î–æ–º–∞—à–Ω–∏–π —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π', '0.4 L', 30000, 'lemonades'),
    mkFood('lemonade_homemade_citrus_1', '–î–æ–º–∞—à–Ω–∏–π —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π', '1 L', 60000, 'lemonades')
  ],
  milkshake: [
    mkFood('milkshake_vanilla_03', '–í–∞–Ω–∏–ª—å–Ω—ã–π', '0.3 L', 40000, 'milkshake'),
    mkFood('milkshake_banana_03', '–ë–∞–Ω–∞–Ω–æ–≤—ã–π', '0.3 L', 50000, 'milkshake'),
    mkFood('milkshake_raspberry_03', '–ú–∞–ª–∏–Ω–æ–≤—ã–π', '0.3 L', 50000, 'milkshake'),
    mkFood('milkshake_strawberry_03', '–ö–ª—É–±–Ω–∏—á–Ω—ã–π', '0.3 L', 50000, 'milkshake'),
    mkFood('milkshake_chocolate_03', '–®–æ–∫–æ–ª–∞–¥–Ω—ã–π', '0.3 L', 50000, 'milkshake'),
    mkFood('milkshake_choc_banana_03', '–®–æ–∫–æ–ª–∞–¥–Ω–æ-–±–∞–Ω–∞–Ω–æ–≤—ã–π', '0.3 L', 50000, 'milkshake')
  ],
  drinks: [
    mkFood('drink_adrenaline_025', 'Adrenaline Rush', '0.25 L', 15000, 'drinks'),
    mkFood('drink_adrenaline_049', 'Adrenaline Rush', '0.49 L', 20000, 'drinks'),
    mkFood('drink_viko_1', '–°–æ–∫ VIKO', '1 L', 25000, 'drinks'),
    mkFood('drink_redbull_025', 'Red Bull', '0.25 L', 35000, 'drinks'),
    mkFood('drink_7up_025', '7Up', '0.25 L', 15000, 'drinks'),
    mkFood('drink_mirinda_025', 'Mirinda', '0.25 L', 15000, 'drinks'),
    mkFood('drink_mirinda_1', 'Mirinda', '1 L', 20000, 'drinks'),
    mkFood('drink_pepsi_025', 'Pepsi', '0.25 L', 15000, 'drinks'),
    mkFood('drink_pepsi_1', 'Pepsi', '1 L', 20000, 'drinks')
  ],
  mineral: [
    mkFood('water_chortoq_05', 'Chortoq', '0.5 L', 25000, 'mineral'),
    mkFood('water_blanc_bleu_05', 'Blanc Bleu (–≥–∞–∑/–±–µ–∑–≥–∞–∑)', '0.5 L', 25000, 'mineral'),
    mkFood('water_karlovy_vary_05', 'Karlovy Vary', '0.5 L', 25000, 'mineral'),
    mkFood('water_evita_1', '–≠–≤–∏—Ç–∞ (–≥–∞–∑/–±–µ–∑–≥–∞–∑)', '1 L', 10000, 'mineral'),
    mkFood('water_borjomi_033', '–ë–æ—Ä–∂–æ–º–∏', '0.33 L', 20000, 'mineral'),
    mkFood('water_borjomi_05', '–ë–æ—Ä–∂–æ–º–∏', '0.5 L', 25000, 'mineral'),
    mkFood('water_borjomi_pear_05', '–ë–æ—Ä–∂–æ–º–∏ –ì—Ä—É—à–∞', '0.5 L', 25000, 'mineral'),
    mkFood('water_borjomi_mandarin_05', '–ë–æ—Ä–∂–æ–º–∏ –ú–∞–Ω–¥–∞—Ä–∏–Ω', '0.5 L', 25000, 'mineral'),
    mkFood('water_borjomi_citrus_033', '–ë–æ—Ä–∂–æ–º–∏ –¶–∏—Ç—Ä—É—Å', '0.33 L', 20000, 'mineral'),
    mkFood('water_borjomi_citrus_05', '–ë–æ—Ä–∂–æ–º–∏ –¶–∏—Ç—Ä—É—Å', '0.5 L', 25000, 'mineral'),
    mkFood('water_borjomi_tarkhun_05', '–ë–æ—Ä–∂–æ–º–∏ –¢–∞—Ä—Ö—É–Ω', '0.5 L', 25000, 'mineral')
  ]
};

/* index all items */
const ITEM_INDEX = {};
(function buildIndex(){
  for(const catKey in MENU){
    (MENU[catKey]||[]).forEach(it => ITEM_INDEX[it.id] = it);
  }
})();

function nameOf(id){
  const it = ITEM_INDEX[id];
  return (it && it.n && (it.n[lang] || it.n.ru)) ? (it.n[lang] || it.n.ru) : id;
}

/* welcome + ui */
function renderWelcome(){
  const el = document.getElementById('welcomeLine');
  if(!el) return;
  const name = (tg_first_name || tg_username || '').trim();
  if(!name){ el.style.display='none'; return; }
  el.style.display='block';
  el.innerText = `${UI[lang].welcome}, ${name}!`;
}

function applyUI(){
  document.getElementById('brandSub').innerText = UI[lang].brandSub;
  document.getElementById('brandPhone').innerText = PHONE_HUMAN;

  menuTitle.innerText = UI[lang].menu;

  mAboutTitle.innerText = UI[lang].aboutTitle;
  mAboutSub.innerText   = UI[lang].aboutSub;
  aboutAddrLabel.innerText  = UI[lang].aboutAddr;
  aboutPhoneLabel.innerText = UI[lang].aboutPhone;
  aboutHoursLabel.innerText = UI[lang].aboutHours;

  mCallTitle.innerText = UI[lang].callTitle;
  mCallSub.innerText = PHONE_HUMAN;
  mInstaTitle.innerText = "@artcafesamarkand";
  mInstaSub.innerText = UI[lang].instaSub;

  searchTitle.innerText = UI[lang].searchResults;

  cartTitle.innerText = UI[lang].cart;
  totalLabel.innerText = UI[lang].total;
  orderBtn.innerText = UI[lang].order;
  comment.placeholder = UI[lang].comment;

  sumCurrency.innerText = UI[lang].sum;
  sumWord.innerText = UI[lang].sum;
  sumWord2.innerText = UI[lang].sum;

  stickyCartBtn.innerText = UI[lang].cart;

  aboutPhoneNum.innerText = PHONE_HUMAN;
  aboutPhoneNum.href = "tel:" + PHONE_RAW;
  aboutHoursText.innerText = "09:00‚Äì18:00";
  mapsBtn.innerText = UI[lang].mapsBtn;

  const mMgrT = document.getElementById('mManagerTitle');
  const mMgrS = document.getElementById('mManagerSub');
  if(mMgrT) mMgrT.innerText = UI[lang].managerTitle;
  if(mMgrS) mMgrS.innerText = UI[lang].managerSub;

  const mLegT = document.getElementById('mLegalTitle');
  const mLegS = document.getElementById('mLegalSub');
  if(mLegT) mLegT.innerText = UI[lang].legalTitle;
  if(mLegS) mLegS.innerText = UI[lang].legalSub;

  const d = document.getElementById('aboutDescText');
  if(d){
    d.innerHTML = (lang==='ru')
      ? `Art Cafe ‚Äî <b>Samarkand</b>.<br><br><b>–ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑:</b><br>1) –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é<br>2) –î–æ–±–∞–≤—å—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É<br>3) –ù–∞–∂–º–∏—Ç–µ ‚Äú${UI[lang].order}‚Äù<br><br><span class="muted">*–¶–µ–Ω—ã —É–∫–∞–∑–∞–Ω—ã –≤ —Å—É–º–∞—Ö.</span>`
      : (lang==='uz')
      ? `Art Cafe ‚Äî <b>Samarkand</b>.<br><br><b>Buyurtma berish:</b><br>1) Kategoriyani tanlang<br>2) Savatga qo‚Äòshing<br>3) ‚Äú${UI[lang].order}‚Äù tugmasini bosing<br><br><span class="muted">*Narxlar so‚Äòmda.</span>`
      : `Art Cafe ‚Äî <b>Samarkand</b>.<br><br><b>How to order:</b><br>1) Choose category<br>2) Add items to cart<br>3) Press ‚Äú${UI[lang].order}‚Äù<br><br><span class="muted">*Prices are in UZS.</span>`;
  }

  renderWelcome();
  renderCats();
  if(!isSearchOpen()) renderProducts();
  updateTotal();
  setTimeout(syncStickyHeight, 50);
}

/* menu actions */
function openTopMenu(){ closeSearch(); menuBackdrop.classList.add('show'); menuSheet.classList.add('show'); }
function closeTopMenu(){ menuBackdrop.classList.remove('show'); menuSheet.classList.remove('show'); }

function callPhone(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  const url="tel:"+PHONE_RAW;
  try{Telegram.WebApp.openLink(url);}catch(_){window.location.href=url;}
}

function openMapsHeader(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  try{Telegram.WebApp.openLink(MAPS_URL);}catch(_){window.open(MAPS_URL,'_blank');}
}

function openInstagram(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  closeTopMenu();
  try{Telegram.WebApp.openLink(INSTA_URL);}catch(_){window.open(INSTA_URL,'_blank');}
}
function openMaps(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  closeTopMenu();
  try{Telegram.WebApp.openLink(MAPS_URL);}catch(_){window.open(MAPS_URL,'_blank');}
}

function toggleAbout(){
  const w=document.getElementById('aboutWrap');
  w.style.display=(w.style.display==='none'||!w.style.display)?'block':'none';
}

/* ‚úÖ –Æ—Ä –ª–∏—Ü–∞–º */
function toggleLegal(){
  const w=document.getElementById('legalWrap');
  w.style.display=(w.style.display==='none'||!w.style.display)?'block':'none';
}
function openEmail(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  const url="mailto:"+LEGAL_EMAIL;
  try{Telegram.WebApp.openLink(url);}catch(_){window.location.href=url;}
}
function callLegalPhone(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  const url="tel:"+LEGAL_PHONE_RAW;
  try{Telegram.WebApp.openLink(url);}catch(_){window.location.href=url;}
}

/* ‚úÖ –º–µ–Ω–µ–¥–∂–µ—Ä: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ID */
function openManager(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  closeTopMenu();

  const tgUrl = `tg://user?id=${MANAGER_ID}`;
  try{
    Telegram.WebApp.openTelegramLink?.(tgUrl);
    return;
  }catch(_){}

  try{
    Telegram.WebApp.openLink(tgUrl);
  }catch(_){
    window.location.href = tgUrl;
  }
}

/* categories */
function catLabel(key){ return CATEGORY_LABELS?.[key]?.[lang] || key; }

function renderCats(){
  cats.innerHTML='';
  MAIN_CATS.forEach(c=>{
    const title = catLabel(c.key);
    const isActive = (category===c.key) ? 'active' : '';
    cats.innerHTML += `<button class="btn cat-btn ${isActive}" onclick="onCategoryClick('${c.key}')">${escapeHtml(title)}</button>`;
  });
}
function onCategoryClick(k){
  category=k;
  renderCats();
  if(!isSearchOpen()) renderProducts();
}

/* search */
function isSearchOpen(){ return searchWrap.classList.contains('show'); }
function toggleSearch(){ isSearchOpen()?closeSearch():openSearch(); }
function openSearch(){
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  searchInput.value='';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  searchInput.value='';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key==='Enter') closeSearch(); }

function matchesQuery(it,q){
  if(!q) return true;
  const all=[
    it.n?.ru,it.n?.uz,it.n?.en,
    String(it.meta||''),
    String(it.id||''),
    String(it.p||'')
  ].filter(Boolean).join(' ').toLowerCase();
  return all.includes(q);
}

function iterAllItems(fn){
  for(const catKey in MENU){
    (MENU[catKey]||[]).forEach(it=>fn(it,catKey));
  }
}

function searchProducts(){
  const q=(searchInput.value||'').trim().toLowerCase();
  products.innerHTML='';
  if(!q){ renderProducts(); return; }

  let found=0;
  iterAllItems((it)=>{
    if(matchesQuery(it,q)){
      cart[it.id]=cart[it.id]||0;
      products.innerHTML += cardHTML(it);
      found++;
    }
  });

  if(found===0){
    products.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:18px;font-weight:900;opacity:.9;background:rgba(0,0,0,.03);border:1px solid rgba(0,0,0,.08);border-radius:18px;">
      ${escapeHtml(UI[lang].nothing)}
    </div>`;
  }
}

/* products */
function cardHTML(it){
  const id=it.id;
  const qty=cart[id]||0;
  const meta = it.meta ? String(it.meta) : '';
  return `
  <div class="card">
    <div class="img">
      <img src="${it.img}" onerror="this.src='images/logo.png'" onclick="openImage(event,'${id}')">
    </div>
    <div class="item-name">${escapeHtml(nameOf(id))}</div>
    <div class="item-meta">${escapeHtml(meta || '')}</div>
    <div class="price">${formatSum(it.p)} <small>${UI[lang].sum}</small></div>
    <div class="counter">
      <button type="button" onclick="chg('${id}',-1)">‚àí</button>
      <span id="c_${id}">${qty}</span>
      <button type="button" onclick="chg('${id}',1)">+</button>
    </div>
  </div>`;
}

function renderProducts(){
  products.innerHTML='';
  const list = MENU[category] || [];
  list.forEach(it=>{
    cart[it.id]=cart[it.id]||0;
    products.innerHTML += cardHTML(it);
  });
}

/* image modal */
function openImage(e,id){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  const it=ITEM_INDEX[id];
  if(!it) return;

  imgModalTitle.innerText = nameOf(id);
  imgModalImg.src = it.img || 'images/logo.png';
  imgModalImg.onerror=function(){this.onerror=null;this.src='images/logo.png';};

  const meta = `${UI[lang].metaPrefix}: ${it.meta || '‚Äî'}\n${UI[lang].price}: ${formatSum(it.p)} ${UI[lang].sum}`;
  imgDescTitle.innerText = nameOf(id);
  imgDescMeta.innerText = meta;

  const desc = (it.desc && (it.desc[lang] || it.desc.ru)) ? (it.desc[lang] || it.desc.ru) : '';
  imgDescText.innerText = desc;

  const chips = document.getElementById('imgDescChips');
  chips.innerHTML = '';
  if(it.meta) chips.innerHTML += `<div class="chip">${escapeHtml(it.meta)}</div>`;
  chips.innerHTML += `<div class="chip">${formatSum(it.p)} ${escapeHtml(UI[lang].sum)}</div>`;
  chips.innerHTML += `<div class="chip">${escapeHtml(catLabel(category))}</div>`;

  imgModal.classList.add('show');
}
function closeImgModal(e){
  try{e.preventDefault();e.stopPropagation();}catch(_){}
  imgModal.classList.remove('show');
  imgModalImg.src='';
}

/* cart */
function syncCounters(id){
  const c=document.getElementById('c_'+id);
  if(c) c.innerText=cart[id]||0;
}
function calcItemsSum(){
  let s=0;
  for(const id in cart) s += (cart[id]||0) * (ITEM_INDEX[id]?.p||0);
  return s;
}
function updateTotal(){
  const itemsSum=calcItemsSum();
  total.innerText=formatSum(itemsSum);
  grandTotal.innerText=formatSum(itemsSum);
  stickyTotal.innerText=formatSum(itemsSum);
}
function chg(id,delta){
  cart[id]=Math.max(0,(cart[id]||0)+delta);
  syncCounters(id);
  updateTotal();
}

/* order */
function genOrderId(){
  const d=new Date();
  const dd=String(d.getDate()).padStart(2,'0');
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const key=`artcafe_seq_${d.getFullYear()}${mm}${dd}`;
  let n=Number(localStorage.getItem(key)||0)+1;
  localStorage.setItem(key,String(n));
  return `ARTCAFE-${dd}${mm}-${String(n).padStart(3,'0')}`;
}
let toastTimer=null;
function showToast(t){
  popup.classList.add('show');
  popupText.innerText = t || "‚úÖ";
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>popup.classList.remove('show'), 1200);
}

function sendOrder(){
  const items=[];
  for(const id in cart){
    const qty=Number(cart[id]||0);
    if(qty>0){
      const it=ITEM_INDEX[id]||{};
      items.push({
        id, qty,
        price: it.p||0,
        name_ru: it.n?.ru||id,
        name_lang: nameOf(id),
        meta: it.meta || null,
        category: category
      });
    }
  }
  if(items.length===0){
    alert(UI[lang].empty);
    return;
  }

  showToast("‚úÖ");

  const totalSum=calcItemsSum();

  const payload={
    action:'order',
    brand:'Art Cafe',
    tg:{id:tg_id,username:tg_username,first_name:tg_first_name},
    items,
    total: formatSum(totalSum),
    total_num: totalSum,
    comment: comment.value,
    order_id: genOrderId(),
    lang
  };

  setTimeout(()=>{
    try{
      Telegram.WebApp.sendData(JSON.stringify(payload));
      Telegram.WebApp.close();
    }catch(_){
      try{ Telegram.WebApp.close(); }catch(__){}
    }
  },700);
}

function openCart(){
  const el=document.getElementById('cartBox');
  syncStickyHeight();
  try{ el.scrollIntoView({behavior:'smooth', block:'start'}); }catch(_){}
}

/* language */
function setLang(l,btn){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  applyUI();
}

/* init theme */
try{
  Telegram.WebApp.setHeaderColor?.('#0F2A2E');
  Telegram.WebApp.setBackgroundColor?.('#F6EAD6');
}catch(_){}

/* init */
renderCats();
renderProducts();

lang='ru';
document.querySelectorAll('.langs .btn').forEach(b=>b.classList.remove('active'));
document.getElementById('langRU')?.classList.add('active');

applyUI();
updateTotal();
setTimeout(syncStickyHeight, 50);
closeSearch();
</script>
</body>
</html>
